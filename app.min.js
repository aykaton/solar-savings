(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);class t{#e={};#t=0;#s=0;#r;#n;static itemTemplateId="progress-bar-item";static itemClassName="progress-bar__item";static itemCaptionClassName="progress-bar__item-caption";static itemStateClassName="progress-bar__item-state";static itemHiddenClassName="progress-bar__item_hidden";constructor(e,s){this.#r=e,this.#n=s;const r=document.querySelector(`.${e}`),n=document.getElementById(t.itemTemplateId).innerHTML;r.innerHTML=s.reduce(((e,t,s)=>{t.alias&&(this.#e[t.alias]=t);const r=t.subStepsCount>1?`0/${t.subStepsCount}`:"";return e+n.replace("{{idx}}",s).replace("{{caption}}",t.caption).replace("{{state}}",r)}),"");r.firstElementChild.classList.remove(t.itemHiddenClassName);r.lastElementChild.lastElementChild.remove()}next(){if(this.#t>=this.#n.length)return!1;const e=this.#n[this.#t],s=document.querySelector(`.${this.#r}`).querySelector(`[data-idx='${this.#t}']`);return this.#s<e.subStepsCount-1?(this.#s++,s.lastElementChild.textContent=`${this.#s}/${e.subStepsCount}`):(this.#s=0,this.#t++,s.classList.add("progress-bar__item_fulfilled"),this.#t<this.#n.length&&(s.lastElementChild.textContent=null,s.lastElementChild.classList.add("icon-success-arrow"),s.nextElementSibling.classList.remove(t.itemHiddenClassName))),!0}prev(){if(this.#t<=0)return!1;const e=document.querySelector(`.${this.#r}`);let t,s;this.#s>0?(this.#s--,t=e.querySelector(`[data-idx='${this.#t}']`),s=this.#n[this.#t],t.lastElementChild.textContent=`${this.#s}/${s.subStepsCount}`):(this.#t--,t=e.querySelector(`[data-idx='${this.#t}']`),s=this.#n[this.#t],t.lastElementChild.classList.remove("icon-success-arrow"),t.classList.remove("progress-bar__item_fulfilled"),s.subStepsCount>1&&(this.#s=s.subStepsCount-1,t.lastElementChild.textContent=`${this.#s}/${s.subStepsCount}`))}}const s=(...e)=>{false && console.log(...e)};function r(e){return"string"==typeof e&&e.length>0}const n=[{alias:"power_bill",caption:"POWER BILL",subStepsCount:1},{alias:"address",caption:"ADDRESS",subStepsCount:1},{alias:"home_type",caption:"HOME TYPE",subStepsCount:2},{alias:"credit_score",caption:"CREDIT SCORE",subStepsCount:1},{alias:"contact",caption:"CONTACT",subStepsCount:3},{alias:"thank_you",caption:"THANK YOU",subStepsCount:1}],a=["avaragePowerBill","address","homeType","roofShade","creditScore","contact","email","phoneNumber","booking","thankYou"];class i{_onChangeListeners=[];_min;_max;_volume;_indicator;_value;_progress;_percentage;_thumbWidth;constructor(e,t,s,r){const n=document.querySelector(`.${e}`);this._min=n.getAttribute("min"),this._max=n.getAttribute("max"),this._volume=this._max-this._min,this._setValue(n.value),this._thumbWidth=t||40;const a=e=>{const t=e.offsetWidth,n=this._thumbWidth/t,a=n/2*100,i=a+this._percentage*(1-n);let o=`linear-gradient(90deg, ${s} ${a}%, ${s} ${i}%`;this._progress<this._volume&&(o+=`, ${void 0!==r?r:"rgba(255,255,255,0)"} ${i}%`),o+=")",e.style.backgroundImage=o};a(n),n.addEventListener("input",(e=>{e.preventDefault(),this._setValue(e.currentTarget.value),a(e.currentTarget),this._indicator&&this._updateIndicator(),this._onChangeListeners.forEach((e=>e(this._value,this._percentage)))}))}_setValue(e){this._value=e,this._progress=this._value-this._min,this._percentage=this._progress/this._volume*100}_updateIndicator(){this._indicator.set(this._value,this._percentage)}getValue(){return this._value}addIndicator(e){this._indicator=e,this._updateIndicator()}subscribe(e){this._onChangeListeners.push(e)}unsubscribe(e){this._onChangeListeners=this._onChangeListeners.filter((t=>t!==e))}}class o{_rootId;_template;constructor(e,t){this._rootId=e,this._template=t}set(e,t){const s=document.querySelector(`#${this._rootId}`),r=(s.clientWidth,s.firstElementChild);r.textContent=this._template?this._template.replace("{{value}}",e):e;const n=r.offsetWidth;r.style.marginLeft=`calc(${t}% - ${n/2}px)`}}class c{static rootClassName=".base-form__address-field";_getRootNode=()=>document.querySelector(c.rootClassName);constructor(e){this._state=e;const t=this._getRootNode();t.lastElementChild.addEventListener("blur",(e=>{this._onBlur(e)})),e.store.isGoogleApiInit?this._initAutocomplete(t):e.onChange(((e,s)=>{e.isGoogleApiInit!==s.isGoogleApiInit&&e.isGoogleApiInit&&this._initAutocomplete(t)}))}_initAutocomplete(e){const t=(e||this._getRootNode()).lastElementChild,r=new google.maps.places.Autocomplete(t,{fields:["formatted_address","geometry","name"],strictBounds:!1,types:["establishment"],componentRestrictions:{country:"us"}});r.addListener("place_changed",(()=>{const e=r.getPlace();this._state.set((t=>({...t,address:e.formatted_address,isAddressAutocompleted:!0})))})),s("address autocomplete initialized")}_onBlur(e){this._state.set((t=>({...t,address:e.currentTarget.value,isAddressAutocompleted:!1})))}}class l{_formName;_name;constructor(e,t,s){this._formName=e,this._name=t;const r=document.forms[this._formName][this._name],n=e=>{s.set((s=>({...s,[t]:e.currentTarget.value})))};r.forEach((e=>e.addEventListener("change",n)))}}class d{_formName;_name;constructor(e,t,s,n,a){this._formName=e,this._name=t;const i=document.forms[this._formName][this._name],o=`is${t.replace(/^(.)/g,((e,t)=>t.toUpperCase()))}Valid`;i.addEventListener("change",(e=>{s.set((s=>{const a=e.currentTarget.value;let i={...s,[t]:a};if(n)if(r(a)){const t=n(a);t?(e.currentTarget.parentElement.classList.remove("error"),e.currentTarget.parentElement.classList.add("valid")):(e.currentTarget.parentElement.classList.add("error"),e.currentTarget.parentElement.classList.remove("valid")),i[o]=t}else e.currentTarget.parentElement.classList.remove("error"),e.currentTarget.parentElement.classList.remove("valid"),i[o]=!1;return i}))})),i.addEventListener("input",(e=>{let i,c=e.currentTarget.value;i=n?n(c):r(c),i?(e.currentTarget.parentElement.classList.remove("error"),e.currentTarget.parentElement.classList.add("valid")):(e.currentTarget.parentElement.classList.remove("valid"),a&&(e.currentTarget.value=a(c))),s.set((s=>({...s,[o]:i,[t]:e.currentTarget.value})))}))}}class u{_formName;_name;constructor(e,t,s){this._formName=e,this._name=t;const r=document.forms[this._formName][this._name],n=r.parentElement,a=e=>{s.set((s=>({...s,[t]:e.checked})))};a(r);r.addEventListener("change",(e=>{a(e.currentTarget)})),r.addEventListener("click",(e=>{e.stopPropagation()})),n.addEventListener("click",(e=>{e.preventDefault(),e.currentTarget.firstElementChild.checked=!e.currentTarget.firstElementChild.checked,e.currentTarget.firstElementChild.dispatchEvent(new Event("change"))}))}}class h{static rootClassName=".step-page-btn";static captionClassName=".step-page-btn__caption";_type;_selectNode(){return document.querySelector(`${h.rootClassName}[data-type="${this._type}"]`)}constructor(e){this._type=e}hide(){this._selectNode().classList.add("hidden")}show(){this._selectNode().classList.remove("hidden")}disable(){this._selectNode().disabled=!0}enable(){this._selectNode().disabled=!1}setCaption(e){this._selectNode().querySelector(h.captionClassName).textContent=e}}class p extends h{_state;constructor(e){super("next"),this._state=e,this._state.onChange(((e,t)=>{t.currentStep;const s=a[e.currentStep],{isGoogleApiInit:n,isAddressAutocompleted:i}=e;!function(t){switch(t){case"avaragePowerBill":return!0;case"address":const{isGoogleApiInit:t,isAddressAutocompleted:s}=e;return s||!t;case"homeType":const{homeType:n}=e;return void 0!==n;case"roofShade":const{roofShade:a}=e;return void 0!==a;case"creditScore":const{creditScore:i}=e;return void 0!==i;case"contact":const{firstName:o,lastName:c}=e;return r(o)&&r(c);case"email":const{isEmailValid:l}=e;return l;case"phoneNumber":const{isPhoneNumberValid:d}=e;return d;default:return!1}}(s)?this.disable():this.enable(),!function(e){switch(e){case"avaragePowerBill":case"address":case"homeType":case"roofShade":case"creditScore":case"contact":case"email":case"phoneNumber":return!0;default:return!1}}(s)?this.hide():this.show(),"phoneNumber"===s?this.setCaption("View savings report"):this.setCaption("Next")})),this._selectNode().addEventListener("click",(e=>{e.preventDefault();const t=()=>{this._state.set((e=>({...e,currentStep:e.currentStep+1})))},{currentStep:s}=this._state.store;t()}))}}class m extends h{_state;constructor(e){super("prev"),this._state=e;const t=e=>{const t=a[e.currentStep];"homeType"===t||"roofShade"===t||"address"===t||"creditScore"===t||"contact"===t||"email"===t||"phoneNumber"===t?this.show():this.hide()};t(this._state.store),this._state.onChange(((e,s)=>{t(e)})),this._selectNode().addEventListener("click",(e=>{e.preventDefault(),this._state.set((e=>({...e,currentStep:e.currentStep-1})))}))}}class g{_state;constructor(e,t,s){this._state=e,this._state.onChange(((e,r,n)=>{if(e.processing&&(0===e.processingProgress||e.processingProgress!==r.processingProgress)){const r=document.querySelector(".processing-indicator__bar");let a=`linear-gradient(90deg, ${t} 0%, ${t} ${e.processingProgress}%`;a+=`, ${void 0!==s?s:"rgba(255,255,255,0)"} ${e.processingProgress}%`,a+=")",r.style.backgroundImage=a,e.processingProgress<80&&setTimeout((()=>{n((e=>({...e,processingProgress:e.processingProgress+10*Math.random()})))}),500)}}))}}class _{static rootClassName=".page";_state;_selectNode(){return document.querySelector(_.rootClassName)}constructor(e){this._state=e,this._selectNode().setAttribute("data-step",a[e.store.currentStep]),this._state.onChange(((e,t)=>{if(e.processing)this._selectNode().setAttribute("data-step",e.processing);else{const t=a[e.currentStep];this._selectNode().setAttribute("data-step",t)}}))}}const S=new class{_store;_prevStore={};_subscriptions=[];constructor(e={}){this._store=e}set(e){this._prevStore=this._store,this._store=e(this._store),this._subscriptions.forEach((e=>e(this._store,this._prevStore,(e=>{this.set(e)})))),s(`_store: ${JSON.stringify(this._store)}, prevStore: ${JSON.stringify(this._prevStore)}`)}get store(){return this._store}onChange(e){this._subscriptions.push(e)}}({isGoogleApiInit:!1,currentStep:0});function b(e,t){window.frames.calendar.contentWindow.postMessage({action:e,payload:t},"*")}function f(e){const t=Object.assign({},e);t.phoneNumber=`+1${t.phoneNumber}`,b("setFieldsAndSend",t)}window.initGoogleApi=()=>{S.set((e=>({...e,isGoogleApiInit:!0})))},window.addEventListener("DOMContentLoaded",(function(e){!function(){new _(S);const e=new t("guide__progress-bar",n);S.onChange(((t,s,r)=>{const{currentStep:n}=t,i=s.currentStep,o=a[n];if(t.processingProgress!==s.processingProgress&&t.processingProgress>80&&"homeType"===o&&r((e=>({...e,processing:null,processingProgress:0}))),n!==i)if(n<i?e.prev():e.next(),"homeType"===o)r((e=>({...e,processing:"checkingRebates",processingProgress:0})));else if("booking"===o){const e=document.querySelector(".booking-step__title"),s=e.textContent;e.textContent=s.replace("{{firstName}}",t.firstName),r((e=>({...e,processing:"processingForm",processingProgress:0}))),f(t)}t.calendarIsReady!==s.calendarIsReady&&t.calendarIsReady&&(t.firstGhlFormIsSent?r((e=>({...e,processing:!1}))):b("skipDateTimePick")),t.formIsAvailable&&t.formIsAvailable!=s.formIsAvailable&&t.firstGhlFormIsSent&&(r((e=>({...e,processing:"processingForm",processingProgress:0}))),function(e){f(e)}(t)),t.ghlFormIsSent&&t.ghlFormIsSent!==s.ghlFormIsSent&&(t.firstGhlFormIsSent?r((e=>({...e,currentStep:e.currentStep+1,processing:null,processingProgress:0}))):(r((e=>({...e,firstGhlFormIsSent:!0,ghlFormIsSent:!1,calendarIsReady:!1,formIsAvailable:!1,dataTimeIsPicked:!1}))),b("reload")));const{roofShade:c,creditScore:l,homeType:d}=t,u=s.roofShade,h=s.creditScore,p=s.homeType;c===u&&l===h&&d===p||r((e=>({...e,currentStep:e.currentStep+1})))}));new p(S),new m(S);const s=new i("range__input",40,"#00ABA1"),r=new o("power-bill-indicator","${{value}}");s.addIndicator(r),s.subscribe((e=>{S.set((t=>({...t,avarageBill:e})))})),S.set((e=>({...e,avarageBill:s.getValue()})));new c(S),new l("quiz","homeType",S),new l("quiz","roofShade",S),new l("quiz","creditScore",S),new d("quiz","firstName",S),new d("quiz","lastName",S),new u("quiz","isOwner",S),new d("quiz","email",S,(e=>"string"==typeof e&&/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e))),new u("quiz","emailMe",S),new d("quiz","phoneNumber",S,(e=>"string"==typeof e&&/^\(\d{3}\)\s\d{3}-\d{4}$/.test(e)),(e=>{if(!e||"string"!=typeof e)return"";const t=e.replace(/^\+1?/,"").match(/\d/gi);return t?t.reduce(((e,t)=>{switch(e.length){case 0:e.push("(");break;case 4:e.push(")"," ");break;case 9:e.push("-")}return e.push(t),e}),[]).join(""):""})),new g(S,"#00ABA1")}()})),window.addEventListener("message",(function(e){switch(e.data.action){case"calendarIsReady":S.set((e=>({...e,calendarIsReady:!0})));break;case"formIsAvailable":S.set((e=>({...e,formIsAvailable:!0})));break;case"dataTimeIsPicked":S.set((e=>({...e,dataTimeIsPicked:!0})));break;case"formIsSent":S.set((t=>({...t,ghlFormIsSent:!0,addToCalendarLinks:e.data.payload})));break;case"error":S.set((t=>({...t,ghlFormError:e.data.payload})));break;case"bookingCompleteResponse":S.set((t=>({...t,bookingCompleteResponse:e.data.payload})))}})),window.FLS=!0,function(e){let t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}))})();